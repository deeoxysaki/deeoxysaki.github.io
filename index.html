import React, { useState, useRef, useEffect } from 'react';
import { Shield, LayoutDashboard, Scan, Activity, FileCode, AlertTriangle, ArrowRight, X, Trash2, Code, Terminal, Cpu, Database, CheckCircle, Minimize2, Maximize2, FileText } from 'lucide-react';

// --- Constants & Helpers ---

const LUA_KEYWORDS = new Set([
  'and', 'break', 'do', 'else', 'elseif', 'end', 'false', 'for', 'function', 'if',
  'in', 'local', 'nil', 'not', 'or', 'repeat', 'return', 'then', 'true', 'until', 'while',
  'print', 'math', 'table', 'string', 'pairs', 'ipairs', 'next', 'select', 'pcall', 'xpcall',
  'type', 'tostring', 'tonumber', 'error', 'assert', 'setmetatable', 'getmetatable', 'rawset', 'rawget',
  'game', 'workspace', 'script', 'wait', 'spawn', 'delay', 'tick', 'task'
]);

// Helper to remove Lua comments before processing
const stripLuaComments = (code) => {
  if (!code) return "";
  // 1. Remove block comments --[[ ... ]]
  let clean = code.replace(/--\[\[[\s\S]*?\]\]/g, '');
  // 2. Remove single line comments -- ...
  clean = clean.replace(/--.*/g, '');
  // 3. Normalize multiple empty lines to single lines for cleaner view
  clean = clean.replace(/^\s*[\r\n]/gm, ''); 
  return clean;
};

const extractAdvancedAnalysis = (code) => {
  // 1. Extract Identifiers (Variables, Function names, Table keys)
  const wordRegex = /\b[a-zA-Z_][a-zA-Z0-9_]*\b/g;
  const allWords = code.match(wordRegex) || [];
  const identifiers = new Set();
  
  // 2. Extract String Literals (Double and Single quotes) - vital for "same appearance"
  const stringRegex = /(["'])(?:(?=(\\?))\2.)*?\1/g;
  const strings = new Set();
  let strMatch;
  while ((strMatch = stringRegex.exec(code)) !== null) {
      strings.add(strMatch[0]); 
  }

  allWords.forEach(word => {
    // We strictly filter keywords to focus on USER defined names (variables, tables, etc)
    if (!LUA_KEYWORDS.has(word) && isNaN(word) && word.length > 1) { 
      identifiers.add(word);
    }
  });

  return { identifiers, strings };
};

// --- Components ---

const CodeViewer = ({ title, code, matches, stringMatches, colorTheme = "red" }) => {
    const lines = code.split('\n');
    
    // Tokenizer for rendering with highlights
    const renderLine = (lineContent) => {
        // Split by strings first, then identifiers
        const tokens = lineContent.split(/((?:["'])(?:(?=(\\?))\2.)*?\1|\b[a-zA-Z_][a-zA-Z0-9_]*\b)/g);
        
        return tokens.map((part, index) => {
            if (!part) return null;

            // Check String Match (High Priority)
            if ((part.startsWith('"') || part.startsWith("'")) && stringMatches.has(part)) {
                return <span key={index} className="text-green-300 font-bold bg-green-900/40 px-0.5 rounded border-b border-green-500 shadow-[0_0_8px_rgba(34,197,94,0.3)]">{part}</span>;
            }

            // Check Exact Identifier Match (Variable/Function/Table)
            if (matches.has(part)) {
                const style = colorTheme === "red" 
                    ? "text-red-100 font-bold bg-red-600/80 px-1 rounded shadow-[0_0_10px_rgba(220,38,38,0.6)]" 
                    : "text-cyan-100 font-bold bg-cyan-600/80 px-1 rounded shadow-[0_0_10px_rgba(8,145,178,0.6)]";
                return <span key={index} className={style}>{part}</span>;
            }

            // Keywords
            if (LUA_KEYWORDS.has(part)) return <span key={index} className="text-purple-400">{part}</span>;
            
            // Unmatched Strings
            if (part.startsWith('"') || part.startsWith("'")) return <span key={index} className="text-green-600">{part}</span>;

            // Default
            return <span key={index} className="text-gray-400">{part}</span>;
        });
    };

    return (
        <div className="flex flex-col h-full bg-[#0a0a0a] border border-gray-800 rounded-lg overflow-hidden shadow-2xl">
            <div className="bg-[#111] px-4 py-3 border-b border-gray-800 flex justify-between items-center bg-gradient-to-r from-gray-900 to-black">
                <span className={`font-mono text-xs font-bold uppercase tracking-wider flex items-center gap-2 ${colorTheme === 'red' ? 'text-red-400' : 'text-cyan-400'}`}>
                    <Code className="w-4 h-4" /> {title}
                </span>
                <span className="text-[10px] font-mono text-gray-500 bg-gray-900 px-2 py-1 rounded-full border border-gray-800">{lines.length} LOC (CLEAN)</span>
            </div>
            <div className="flex-1 overflow-auto p-0 font-mono text-xs md:text-sm custom-scrollbar bg-black/50 backdrop-blur-sm">
                {lines.map((line, i) => (
                    <div key={i} className="flex hover:bg-white/5 transition-colors group">
                        <span className="w-10 flex-shrink-0 text-right text-gray-600 select-none pr-3 border-r border-gray-800 bg-[#050505] py-0.5 font-mono text-[10px] pt-1 group-hover:text-gray-400 transition-colors">{i + 1}</span>
                        <div className="pl-3 py-0.5 whitespace-pre break-all relative">
                            {renderLine(line)}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

const DashboardView = ({ scanHistory, clearHistory }) => (
  <div className="space-y-6 animate-fade-in p-2 font-tech">
    <div className="flex justify-between items-end mb-6">
        <h2 className="text-3xl font-bold text-white tracking-wide drop-shadow-[0_0_10px_rgba(168,85,247,0.5)]">DASHBOARD_OVERVIEW</h2>
        {scanHistory.length > 0 && (
            <button 
                onClick={clearHistory}
                className="text-xs text-red-400 hover:text-red-300 flex items-center gap-2 border border-red-900/30 px-3 py-1 rounded bg-red-900/10 transition-colors hover:bg-red-900/20"
            >
                <Trash2 className="w-3 h-3" /> CLEAR DATA
            </button>
        )}
    </div>

    {scanHistory.length === 0 ? (
      <div className="flex flex-col items-center justify-center h-64 border border-dashed border-purple-900/50 rounded-xl text-gray-500 bg-purple-900/5">
        <Activity className="w-12 h-12 mb-4 opacity-50 text-purple-500 animate-pulse" />
        <p className="font-mono text-sm text-white">NO SCAN DATA AVAILABLE</p>
        <p className="text-xs mt-2 text-gray-400">Go to Scanner to initialize a comparison.</p>
      </div>
    ) : (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {scanHistory.map((scan, index) => (
          <div key={index} className="bg-black border border-purple-900/50 p-6 rounded-xl hover:border-purple-500 transition-all duration-300 shadow-[0_0_15px_rgba(88,28,135,0.1)] hover:shadow-[0_0_25px_rgba(168,85,247,0.2)] group relative overflow-hidden">
             <div className="absolute top-0 right-0 w-24 h-24 bg-purple-900/10 rounded-full blur-2xl pointer-events-none group-hover:bg-purple-600/10 transition-colors"></div>
             
             {/* Card Header with Filenames */}
             <div className="mb-4 border-b border-purple-900/30 pb-3">
                <div className="flex items-center space-x-2 mb-2">
                    <div className="p-1.5 rounded-lg bg-purple-900/30 text-purple-400">
                        <FileCode className="w-4 h-4" />
                    </div>
                    <span className="text-white font-bold font-mono text-xs tracking-wider uppercase">Scan Report #{scanHistory.length - index}</span>
                </div>
                
                <div className="flex flex-col gap-1 mt-2">
                    <div className="flex items-center gap-2 text-[10px] font-mono text-cyan-300 truncate">
                        <span className="bg-cyan-900/30 px-1 rounded text-cyan-500">ORIG</span>
                        {scan.originalName}
                    </div>
                    <div className="flex items-center gap-2 text-[10px] font-mono text-red-300 truncate">
                        <span className="bg-red-900/30 px-1 rounded text-red-500">SUSP</span>
                        {scan.suspectName}
                    </div>
                </div>
             </div>

             <div className="space-y-4">
                <div>
                    <p className="text-purple-400 text-xs uppercase tracking-widest font-semibold mb-1">Match Confidence</p>
                    <div className="flex items-end gap-2">
                        <h3 className={`text-4xl font-bold font-mono leading-none ${scan.percentage > 50 ? 'text-red-500 drop-shadow-[0_0_8px_rgba(239,68,68,0.5)]' : 'text-white'}`}>
                            {scan.percentage}%
                        </h3>
                    </div>
                </div>
                
                <div className="bg-white/5 p-3 rounded-lg border border-white/10 space-y-2">
                    <div className="flex justify-between text-xs">
                        <span className="text-gray-400">Matched Names:</span>
                        <span className="text-white font-mono">{scan.matchesFound}</span>
                    </div>
                    <div className="flex justify-between text-xs">
                        <span className="text-gray-400">Matched Strings:</span>
                        <span className="text-green-400 font-mono font-bold">{scan.stringMatches}</span>
                    </div>
                </div>
                
                <div className="text-[10px] text-gray-500 text-right font-mono">
                    Scanned at: {scan.timestamp}
                </div>
             </div>
          </div>
        ))}
      </div>
    )}
  </div>
);

const ScannerView = ({ onScanComplete }) => {
  const [showPanel, setShowPanel] = useState(false);
  const [originalFile, setOriginalFile] = useState(null);
  const [suspectFile, setSuspectFile] = useState(null);
  const [originalContent, setOriginalContent] = useState("");
  const [suspectContent, setSuspectContent] = useState("");
  const [isProcessing, setIsProcessing] = useState(false);
  const [scanResult, setScanResult] = useState(null);
  const [fullscreen, setFullscreen] = useState(false);

  const fileInputRef1 = useRef(null);
  const fileInputRef2 = useRef(null);

  const handleFileRead = (file, setFileState, setContentState) => {
    if (file) {
        setFileState(file);
        const reader = new FileReader();
        reader.onload = (e) => {
            // STRIP COMMENTS IMMEDIATELY ON LOAD
            const raw = e.target.result;
            const cleaned = stripLuaComments(raw);
            setContentState(cleaned);
        };
        reader.readAsText(file);
    }
  };

  const startScan = () => {
    setIsProcessing(true);
    
    setTimeout(() => {
        // Deep analysis of the CLEANED (comment-free) code
        const origData = extractAdvancedAnalysis(originalContent);
        const suspData = extractAdvancedAnalysis(suspectContent);
        
        const matches = new Set();
        const stringMatches = new Set();
        let matchCount = 0;
        let strCount = 0;

        // 1. Exact Identifier Analysis (Vars, Functions, Table Keys)
        origData.identifiers.forEach(id => {
            if (suspData.identifiers.has(id)) {
                matches.add(id);
                matchCount++;
            }
        });

        // 2. Exact String Literal Analysis (e.g. "RunService", "Player", custom strings)
        origData.strings.forEach(str => {
            if (suspData.strings.has(str)) {
                stringMatches.add(str);
                strCount++;
            }
        });

        // Scoring: We weight strings slightly higher as they are harder to obfuscate automatically
        const totalItems = origData.identifiers.size + origData.strings.size;
        const totalFound = matchCount + strCount;
        
        const percentage = totalItems > 0 
            ? ((totalFound / totalItems) * 100).toFixed(1) 
            : 0;
        
        const result = {
            originalName: originalFile.name,
            suspectName: suspectFile.name,
            totalOriginal: totalItems,
            matchesFound: matchCount,
            stringMatches: strCount,
            percentage: percentage,
            matches: Array.from(matches),
            stringMatchesSet: Array.from(stringMatches),
            originalCode: originalContent,
            suspectCode: suspectContent,
            timestamp: new Date().toLocaleTimeString()
        };

        setScanResult({ 
            ...result, 
            matches: new Set(result.matches),
            stringMatchesSet: new Set(result.stringMatchesSet)
        });
        onScanComplete(result);
        setIsProcessing(false);
        setShowPanel(false);
    }, 2000); // Effect delay
  };

  return (
    <div className={`flex flex-col animate-fade-in relative font-tech ${fullscreen ? 'fixed inset-0 z-50 bg-black p-4' : 'h-full p-2'}`}>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-3xl font-bold text-white tracking-wide flex items-center gap-3 drop-shadow-[0_0_15px_rgba(168,85,247,0.5)]">
            SCANNER_MODULE <span className="text-xs bg-purple-900/50 px-2 py-0.5 rounded text-purple-300 border border-purple-500/30">V3.0 ADVANCED</span>
        </h2>
        {scanResult && (
             <button onClick={() => setFullscreen(!fullscreen)} className="text-gray-400 hover:text-white transition-colors bg-white/5 p-2 rounded hover:bg-white/10">
                {fullscreen ? <Minimize2 className="w-5 h-5"/> : <Maximize2 className="w-5 h-5"/>}
             </button>
        )}
      </div>

      {!scanResult ? (
        <div className="flex-1 bg-black border border-purple-900/50 rounded-xl p-8 flex flex-col items-center justify-center relative overflow-hidden group shadow-[0_0_30px_rgba(88,28,135,0.1)]">
          <div className="absolute inset-0 bg-[linear-gradient(rgba(88,28,135,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(88,28,135,0.1)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20"></div>
          
          <div className="relative mb-8 group-hover:scale-110 transition-transform duration-500">
              <div className="absolute inset-0 bg-purple-500/20 blur-3xl rounded-full animate-pulse"></div>
              <Scan className="w-20 h-20 text-white relative z-10 drop-shadow-[0_0_10px_rgba(168,85,247,0.8)]" />
          </div>
          
          <p className="text-white text-2xl mb-2 font-bold tracking-wide text-center">ADVANCED SOURCE COMPARISON</p>
          <p className="text-gray-400 text-sm mb-10 font-mono tracking-wide text-center max-w-md">
            Detects shared variables, functions, strings, and table structures while ignoring comments.
          </p>
          
          <button 
            onClick={() => setShowPanel(true)}
            className="relative px-12 py-4 bg-purple-600 hover:bg-white hover:text-black text-white transition-all duration-300 uppercase tracking-widest font-bold text-sm rounded-lg group-hover:shadow-[0_0_30px_rgba(168,85,247,0.6)] overflow-hidden"
          >
            <span className="relative z-10 flex items-center gap-2">LOAD SOURCE FILES <ArrowRight className="w-4 h-4" /></span>
          </button>
        </div>
      ) : (
        <div className="flex-1 flex flex-col bg-black border border-purple-900/50 rounded-xl overflow-hidden shadow-2xl">
             {/* Toolbar */}
             <div className="p-4 border-b border-purple-900/50 flex justify-between items-center bg-purple-900/10 backdrop-blur-sm">
                <div className="flex gap-6 text-sm font-mono">
                    <div className="flex items-center gap-2 text-red-400 font-bold bg-red-900/10 px-3 py-1 rounded border border-red-500/30">
                        <AlertTriangle className="w-4 h-4"/> 
                        {scanResult.matchesFound} IDENTIFIERS
                    </div>
                    <div className="flex items-center gap-2 text-green-400 font-bold bg-green-900/10 px-3 py-1 rounded border border-green-500/30">
                        <Terminal className="w-4 h-4"/> 
                        {scanResult.stringMatches} STRINGS
                    </div>
                </div>
                <button onClick={() => setScanResult(null)} className="text-xs text-gray-300 hover:text-white flex items-center gap-1 border border-white/20 px-3 py-1.5 rounded hover:bg-white/10 transition-colors">
                    <X className="w-3 h-3" /> CLOSE REPORT
                </button>
             </div>

             {/* Dual Code View */}
             <div className="flex-1 flex flex-col md:flex-row overflow-hidden relative">
                 {/* Left: Original */}
                 <div className="flex-1 border-b md:border-b-0 md:border-r border-purple-900/30 flex flex-col min-h-0">
                     <CodeViewer 
                        title={`ORIGINAL: ${scanResult.originalName}`} 
                        code={scanResult.originalCode} 
                        matches={scanResult.matches} 
                        stringMatches={scanResult.stringMatchesSet}
                        colorTheme="cyan"
                    />
                 </div>
                 
                 {/* Right: Suspect */}
                 <div className="flex-1 flex flex-col min-h-0">
                    <CodeViewer 
                        title={`SUSPECT: ${scanResult.suspectName}`}
                        code={scanResult.suspectCode} 
                        matches={scanResult.matches} 
                        stringMatches={scanResult.stringMatchesSet}
                        colorTheme="red"
                    />
                 </div>
             </div>
        </div>
      )}

      {/* SCAN PANEL MODAL */}
      {showPanel && (
        <div className="absolute inset-0 z-50 bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
            <div className="bg-black border border-white/10 w-full max-w-lg rounded-2xl shadow-[0_0_60px_rgba(147,51,234,0.3)] animate-fade-in relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-600 via-white to-purple-600"></div>
                
                <button 
                    onClick={() => setShowPanel(false)}
                    className="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full"
                >
                    <X className="w-5 h-5" />
                </button>

                <div className="p-8">
                    <h3 className="text-2xl font-bold text-white mb-8 font-tech border-b border-white/10 pb-4 flex items-center gap-2">
                        <Database className="w-6 h-6 text-purple-500"/> SOURCE LOADER
                    </h3>
                    
                    <div className="space-y-6">
                        {/* Input 1 */}
                        <div>
                            <label className="block text-cyan-400 text-xs font-bold mb-2 uppercase tracking-wider flex justify-between">
                                <span>Original Source (.lua)</span>
                                <span className="text-gray-500 font-mono text-[10px]">COMMENTS WILL BE REMOVED</span>
                            </label>
                            <div 
                                onClick={() => fileInputRef1.current.click()}
                                className={`h-16 border-2 border-dashed rounded-xl flex items-center justify-center cursor-pointer transition-all ${originalFile ? 'border-cyan-500 bg-cyan-900/20 shadow-[0_0_15px_rgba(8,145,178,0.2)]' : 'border-gray-700 bg-white/5 hover:border-cyan-500 hover:bg-cyan-900/10'}`}
                            >
                                <input 
                                    type="file" 
                                    accept=".lua,.txt"
                                    ref={fileInputRef1} 
                                    className="hidden"
                                    onChange={(e) => handleFileRead(e.target.files[0], setOriginalFile, setOriginalContent)}
                                />
                                {originalFile ? (
                                    <span className="text-cyan-400 text-sm flex items-center gap-2 font-bold"><CheckCircle className="w-5 h-5" /> {originalFile.name}</span>
                                ) : (
                                    <span className="text-gray-400 text-sm font-mono">Select Original File</span>
                                )}
                            </div>
                        </div>

                        {/* Input 2 */}
                        <div className="relative">
                            <label className="block text-red-400 text-xs font-bold mb-2 uppercase tracking-wider flex justify-between">
                                <span>Suspect Source (.lua)</span>
                                <span className="text-gray-500 font-mono text-[10px]">COMMENTS WILL BE REMOVED</span>
                            </label>
                            <div 
                                onClick={() => fileInputRef2.current.click()}
                                className={`h-16 border-2 border-dashed rounded-xl flex items-center justify-center cursor-pointer transition-all ${suspectFile ? 'border-red-500 bg-red-900/20 shadow-[0_0_15px_rgba(239,68,68,0.2)]' : 'border-gray-700 bg-white/5 hover:border-red-500 hover:bg-red-900/10'}`}
                            >
                                <input 
                                    type="file" 
                                    accept=".lua,.txt" 
                                    ref={fileInputRef2}
                                    className="hidden"
                                    onChange={(e) => handleFileRead(e.target.files[0], setSuspectFile, setSuspectContent)}
                                />
                                {suspectFile ? (
                                    <span className="text-red-400 text-sm flex items-center gap-2 font-bold"><AlertTriangle className="w-5 h-5" /> {suspectFile.name}</span>
                                ) : (
                                    <span className="text-gray-400 text-sm font-mono">Select Suspect File</span>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Action Button */}
                    <div className="mt-10">
                        {originalFile && suspectFile ? (
                            <button 
                                onClick={startScan}
                                disabled={isProcessing}
                                className="w-full py-4 bg-white hover:bg-gray-200 text-black font-bold uppercase tracking-widest rounded-lg transition-all flex items-center justify-center gap-3 shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(255,255,255,0.5)] transform hover:-translate-y-1"
                            >
                                {isProcessing ? (
                                    <span className="animate-pulse">ANALYZING CODE STRUCTURE...</span>
                                ) : (
                                    <>RUN DEEP SCAN <ArrowRight className="w-5 h-5" /></>
                                )}
                            </button>
                        ) : (
                            <div className="w-full py-4 bg-white/5 text-gray-500 font-bold uppercase tracking-widest rounded-lg text-center cursor-not-allowed border border-white/5">
                                Awaiting Files...
                            </div>
                        )}
                    </div>

                </div>
            </div>
        </div>
      )}
    </div>
  );
};

export default function App() {
  const [activeTab, setActiveTab] = useState('dashboard');
  
  // Initialize state from local storage
  const [scanHistory, setScanHistory] = useState(() => {
    try {
        const saved = localStorage.getItem('eclipse_scan_history_v3');
        return saved ? JSON.parse(saved) : [];
    } catch (e) {
        return [];
    }
  });

  // Save to local storage whenever history changes
  useEffect(() => {
    localStorage.setItem('eclipse_scan_history_v3', JSON.stringify(scanHistory));
  }, [scanHistory]);

  const handleScanComplete = (result) => {
    setScanHistory(prev => [result, ...prev]);
  };

  const clearHistory = () => {
      setScanHistory([]);
      localStorage.removeItem('eclipse_scan_history_v3');
  }

  return (
    <div className="flex h-screen w-full bg-black text-white selection:bg-purple-500 selection:text-white overflow-hidden font-tech">
      
      {/* Global Styles for Animations and Fonts */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700&display=swap');
        
        .font-tech {
            font-family: 'Rajdhani', sans-serif;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Custom scrollbar for code blocks */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #050505; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #444; }

        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
      `}</style>

      {/* Sidebar */}
      <div className="w-20 md:w-64 border-r border-purple-900/30 flex flex-col flex-shrink-0 bg-black relative z-20">
        
        {/* Top Left: Shield Icon */}
        <div className="h-24 flex items-center px-0 md:px-8 justify-center md:justify-start relative">
            <div className="absolute inset-0 bg-purple-900/10 blur-xl"></div>
            <Shield className="w-8 h-8 text-white relative z-10 drop-shadow-[0_0_10px_rgba(168,85,247,0.8)]" />
            <span className="ml-4 font-bold text-2xl tracking-[0.15em] text-white hidden md:block relative z-10 font-tech">ECLIPSE</span>
        </div>

        {/* Horizontal Divider */}
        <div className="h-px w-full bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-50 shadow-[0_0_10px_#a855f7]"></div>

        {/* Navigation / Tab Container */}
        <div className="flex-1 py-8 flex flex-col gap-2 px-3">
          <p className="px-4 text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-4 hidden md:block font-mono">
            Main Modules
          </p>

          {/* Dashboard Tab */}
          <button 
            onClick={() => setActiveTab('dashboard')}
            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-300 group border border-transparent ${
              activeTab === 'dashboard' 
              ? 'bg-white/10 text-white border-l-4 border-l-purple-500 shadow-[inset_0_0_20px_rgba(255,255,255,0.05)]' 
              : 'text-gray-400 hover:text-white hover:bg-white/5'
            }`}
          >
            <LayoutDashboard className={`w-5 h-5 transition-transform group-hover:scale-110 ${activeTab === 'dashboard' ? 'text-white drop-shadow-[0_0_5px_rgba(255,255,255,0.8)]' : 'text-current'}`} />
            <span className="hidden md:block font-bold tracking-wide text-lg">Dashboard</span>
          </button>

          {/* Scanner Tab */}
          <button 
            onClick={() => setActiveTab('scanner')}
            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-300 group border border-transparent ${
              activeTab === 'scanner' 
              ? 'bg-white/10 text-white border-l-4 border-l-purple-500 shadow-[inset_0_0_20px_rgba(255,255,255,0.05)]' 
              : 'text-gray-400 hover:text-white hover:bg-white/5'
            }`}
          >
            <Scan className={`w-5 h-5 transition-transform group-hover:scale-110 ${activeTab === 'scanner' ? 'text-white drop-shadow-[0_0_5px_rgba(255,255,255,0.8)]' : 'text-current'}`} />
            <span className="hidden md:block font-bold tracking-wide text-lg">Scanner</span>
          </button>
        </div>

        {/* Footer Area */}
        <div className="p-6 border-t border-purple-900/30">
          <div className="flex items-center space-x-3 opacity-70 hover:opacity-100 transition-opacity">
            <div className="relative">
                <div className="w-2 h-2 rounded-full bg-green-500"></div>
                <div className="absolute inset-0 rounded-full bg-green-500 animate-ping opacity-75"></div>
            </div>
            <span className="text-xs text-gray-400 font-mono tracking-wider hidden md:block">SYSTEM_ONLINE</span>
          </div>
        </div>
      </div>

      {/* Main Content Area */}
      <div className="flex-1 overflow-y-auto bg-black p-4 md:p-10 relative">
        {/* Ambient Glows */}
        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-purple-900/10 rounded-full blur-[120px] pointer-events-none"></div>
        <div className="absolute bottom-0 left-0 w-[300px] h-[300px] bg-white/5 rounded-full blur-[80px] pointer-events-none"></div>

        <div className="relative z-10 max-w-7xl mx-auto h-full flex flex-col">
             {activeTab === 'dashboard' ? (
                <DashboardView scanHistory={scanHistory} clearHistory={clearHistory} />
             ) : (
                <ScannerView onScanComplete={handleScanComplete} />
             )}
        </div>
      </div>
    </div>
  );
}
